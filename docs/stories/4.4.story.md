# Story 4.4: SEO Optimization

## Status

Done

## Story

**As a** business owner,
**I want** the website optimized for search engines,
**so that** potential clients can find us through organic search.

## Acceptance Criteria

1. Unique title and meta description for each page
2. Open Graph tags for social sharing
3. Semantic HTML structure (proper heading hierarchy)
4. Image alt text for all meaningful images
5. sitemap.xml generated and submitted
6. robots.txt configured appropriately
7. Structured data for organization (JSON-LD)
8. Lighthouse SEO score > 90

## Tasks / Subtasks

- [x] Task 1: Audit existing metadata and identify gaps (AC: 1, 2)
  - [x] Review current metadata in `app/layout.tsx` (root layout)
  - [x] Check page-level metadata exports in all pages:
    - `app/page.tsx` (Homepage - currently missing page metadata)
    - `app/pricing/page.tsx` (has metadata)
    - `app/about/page.tsx` (has metadata)
    - `app/contact/page.tsx` (has metadata)
    - `app/faq/page.tsx` (client component - needs metadata via generateMetadata)
    - `app/privacy/page.tsx` (has metadata)
    - `app/terms/page.tsx` (has metadata)
    - `app/services/amazon/page.tsx` (has metadata)
    - `app/services/etsy/page.tsx` (has metadata)
  - [x] Document which pages need unique title/description updates
  - [x] Verify all pages have Open Graph tags

- [x] Task 2: Add missing page-level metadata (AC: 1, 2)
  - [x] Add metadata export to `app/page.tsx` (Homepage)
  - [x] Convert `app/faq/page.tsx` to support metadata (extract client component or use generateMetadata pattern)
  - [x] Ensure all pages follow the title template pattern from root layout (`%s | Agency Site`)
  - [x] Add Twitter card metadata alongside Open Graph tags
  - [x] Add canonical URL metadata where appropriate

- [x] Task 3: Audit and fix heading hierarchy (AC: 3)
  - [x] Review all pages for proper H1 -> H2 -> H3 hierarchy
  - [x] Ensure each page has exactly one H1
  - [x] Verify sections use appropriate heading levels
  - [x] Check that headings are semantic (not styled divs)

- [x] Task 4: Add alt text to all images (AC: 4)
  - [x] Audit all `next/image` components for alt text
  - [x] Add descriptive alt text to placeholder result images (`public/images/results/`)
  - [x] Ensure decorative images use `alt=""` appropriately
  - [x] Update any images using icons to have proper aria-labels

- [x] Task 5: Create and configure sitemap.xml (AC: 5)
  - [x] Create `app/sitemap.ts` using Next.js sitemap generation
  - [x] Include all public pages: `/`, `/about`, `/contact`, `/faq`, `/pricing`, `/privacy`, `/terms`, `/services/amazon`, `/services/etsy`
  - [x] Set appropriate `lastModified`, `changeFrequency`, and `priority` values
  - [x] Verify sitemap is accessible at `/sitemap.xml`

- [x] Task 6: Create and configure robots.txt (AC: 6)
  - [x] Create `app/robots.ts` using Next.js robots generation
  - [x] Allow all user agents
  - [x] Include sitemap URL reference
  - [x] Disallow `/style-guide` if it exists (dev reference page)
  - [x] Verify robots.txt is accessible at `/robots.txt`

- [x] Task 7: Add JSON-LD structured data (AC: 7)
  - [x] Create organization schema in root layout or homepage
  - [x] Add Organization structured data with:
    - `@type`: "Organization"
    - `name`: Agency name
    - `url`: Site URL
    - `logo`: (if logo image exists)
    - `description`: Agency description
    - `sameAs`: Social media links (if available)
  - [x] Add WebSite schema for site search potential
  - [x] Validate JSON-LD using Google Rich Results Test

- [x] Task 8: Run Lighthouse SEO audit and fix issues (AC: 8)
  - [x] Run Lighthouse audit on all pages
  - [x] Address any SEO issues flagged
  - [x] Ensure SEO score > 90 on all pages
  - [x] Document any items that cannot be addressed (if any)

- [x] Task 9: Final verification (AC: all)
  - [x] Run `npm run lint` - ensure no errors
  - [x] Run `npm run build` - ensure successful build
  - [x] Run `npm run test:run` - ensure all tests pass
  - [x] Verify sitemap.xml is generated correctly
  - [x] Verify robots.txt is generated correctly
  - [x] Test structured data with Google Rich Results Test
  - [x] Run final Lighthouse SEO audit

## Dev Notes

### Previous Story Insights (Story 4.3)
[Source: docs/stories/4.3.story.md#dev-agent-record]

- 385 tests passing with Vitest + React Testing Library
- Cookie consent implementation complete
- PlausibleProvider documented as GDPR-compliant (cookie-free)
- Root layout structure: `CookieConsentProvider` → `PlausibleProvider` → `Header` → `main` → `Footer`
- Lint and build passing

### Current Metadata State
[Source: app/layout.tsx, app/*/page.tsx]

**Root Layout Metadata (`app/layout.tsx`):**
```typescript
export const metadata: Metadata = {
  metadataBase: new URL("https://agency-site.vercel.app"),
  title: {
    default: "Agency Site | E-commerce Consulting for Amazon & Etsy Sellers",
    template: "%s | Agency Site",
  },
  description: "Honest, results-driven consulting to help Amazon and Etsy sellers grow their businesses. Transparent pricing, real expertise.",
  openGraph: {
    type: "website",
    locale: "en_US",
    siteName: "Agency Site",
    title: "Agency Site | E-commerce Consulting for Amazon & Etsy Sellers",
    description: "Honest, results-driven consulting to help Amazon and Etsy sellers grow their businesses.",
  },
};
```

**Pages With Metadata:**
- `/pricing` - Has title, description, openGraph
- `/about` - Has title, description, openGraph
- `/contact` - Has title, description, openGraph
- `/privacy` - Has title, description, openGraph
- `/terms` - Has title, description, openGraph
- `/services/amazon` - Has title, description, openGraph
- `/services/etsy` - Has title, description, openGraph

**Pages Missing/Needing Metadata:**
- `/` (Homepage) - No page-level metadata export (relies on root layout defaults)
- `/faq` - Is a client component (`"use client"`) so cannot export metadata directly

### Next.js 14 Metadata API
[Source: Next.js documentation, existing page patterns]

**Static Metadata Pattern (for server components):**
```typescript
import type { Metadata } from "next";

export const metadata: Metadata = {
  title: "Page Title",
  description: "Page description",
  openGraph: {
    title: "Page Title",
    description: "Page description",
    type: "website",
  },
};
```

**Client Component Metadata Pattern:**
For client components like FAQ page, extract metadata to a separate layout or use generateMetadata in a parent component. Alternative: Keep FAQ page as server component and extract client filtering to a child component.

### Next.js Sitemap Generation
[Source: Next.js 14 documentation]

Create `app/sitemap.ts`:
```typescript
import type { MetadataRoute } from 'next';

export default function sitemap(): MetadataRoute.Sitemap {
  const baseUrl = 'https://agency-site.vercel.app';

  return [
    {
      url: baseUrl,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 1,
    },
    {
      url: `${baseUrl}/about`,
      lastModified: new Date(),
      changeFrequency: 'monthly',
      priority: 0.8,
    },
    // ... other pages
  ];
}
```

### Next.js Robots.txt Generation
[Source: Next.js 14 documentation]

Create `app/robots.ts`:
```typescript
import type { MetadataRoute } from 'next';

export default function robots(): MetadataRoute.Robots {
  return {
    rules: {
      userAgent: '*',
      allow: '/',
      disallow: '/style-guide',
    },
    sitemap: 'https://agency-site.vercel.app/sitemap.xml',
  };
}
```

### JSON-LD Structured Data Pattern
[Source: Next.js documentation, Schema.org]

Add to root layout or homepage:
```typescript
const organizationSchema = {
  "@context": "https://schema.org",
  "@type": "Organization",
  name: "Agency Site",
  url: "https://agency-site.vercel.app",
  description: "Honest, results-driven consulting to help Amazon and Etsy sellers grow their businesses.",
  // logo: "https://agency-site.vercel.app/logo.png",
  // sameAs: ["https://instagram.com/...", "https://linkedin.com/..."]
};

// In component JSX:
<script
  type="application/ld+json"
  dangerouslySetInnerHTML={{ __html: JSON.stringify(organizationSchema) }}
/>
```

### Image Audit
[Source: public/images/]

Current images in `public/images/results/`:
- `placeholder-1.svg`
- `placeholder-2.svg`
- `placeholder-3.svg`
- `placeholder-4.svg`

These are placeholder images for the Results Gallery. When used with `next/image`, ensure descriptive alt text is provided (e.g., "Amazon sales growth dashboard showing 3x increase").

### File Locations for New Files
[Source: docs/architecture/unified-project-structure.md]

```
app/
├── sitemap.ts          # NEW - Sitemap generation
├── robots.ts           # NEW - Robots.txt generation
├── layout.tsx          # MODIFY - Add JSON-LD structured data
├── page.tsx            # MODIFY - Add page-level metadata
├── faq/
│   └── page.tsx        # MODIFY - Refactor for metadata support
```

### FAQ Page Refactoring Strategy
[Source: app/faq/page.tsx analysis]

Current issue: FAQ page is a client component due to useState for category filtering.

**Recommended solution:** Create a layout file for the FAQ page that exports metadata:

```
app/faq/
├── layout.tsx   # NEW - Server component with metadata export
└── page.tsx     # Keep as client component
```

Or refactor to extract client logic:
```
app/faq/
└── page.tsx     # Server component with metadata
components/sections/
└── faq-page-content.tsx  # NEW - Client component with filtering
```

### SEO Best Practices Checklist
[Source: Architecture/coding-standards, Web vitals best practices]

1. **Title Tags**: 50-60 characters, unique per page, include primary keyword
2. **Meta Descriptions**: 150-160 characters, compelling, include call-to-action
3. **Heading Hierarchy**: Single H1 per page, logical H2/H3 nesting
4. **Image Alt Text**: Descriptive, not keyword-stuffed, empty for decorative
5. **Canonical URLs**: Specify preferred URL version
6. **Open Graph**: Title, description, type, image (optional), url
7. **Twitter Cards**: card type, title, description

### Lighthouse SEO Audit Items
[Source: Lighthouse documentation]

Common SEO audit checks:
- Document has a `<title>` element
- Document has a meta description
- Page has successful HTTP status code
- Document has a valid hreflang
- Document has a valid rel=canonical
- Document avoids plugins
- Links are crawlable
- Document uses legible font sizes
- Tap targets are sized appropriately
- robots.txt is valid
- Image elements have [alt] attributes
- Document has valid structured data

## Testing

[Source: docs/architecture/testing-strategy.md]

### Test Locations
- `tests/app/page.test.tsx` - May need updates for metadata
- No specific unit tests needed for sitemap/robots (Next.js handles generation)

### Testing Framework
- Vitest + React Testing Library
- Lighthouse for SEO scoring (manual or CI integration)

### Test Scenarios

1. **Metadata Testing** (if applicable):
   - Verify metadata exports are present on pages
   - Check title template pattern works correctly

2. **Sitemap Verification**:
   - Build site and verify `/sitemap.xml` returns valid XML
   - Verify all expected URLs are present

3. **Robots.txt Verification**:
   - Build site and verify `/robots.txt` is accessible
   - Verify correct allow/disallow rules

4. **Structured Data Verification**:
   - Use Google Rich Results Test
   - Validate JSON-LD syntax

5. **Lighthouse SEO Audit**:
   - Run Lighthouse on each page
   - Verify SEO score > 90

### Manual Testing Checklist
- [ ] Open homepage, verify title in browser tab
- [ ] Share homepage URL on social media preview tool (verify OG tags)
- [ ] Access `/sitemap.xml` in browser
- [ ] Access `/robots.txt` in browser
- [ ] Run Lighthouse audit on homepage
- [ ] Run Lighthouse audit on services pages
- [ ] Test structured data with Google Rich Results Test

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story draft | SM Agent (Bob) |
| 2025-12-06 | 1.1 | Implementation complete - all AC met | Dev Agent (James) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
No debug issues encountered.

### Completion Notes List
- Added metadata exports with title, description, Open Graph, and Twitter cards to all 9 pages
- Homepage (`app/page.tsx`) now has explicit metadata export
- FAQ page already had a layout file (`app/faq/layout.tsx`) with metadata - added Twitter cards
- Created `app/sitemap.ts` with all 9 public pages, appropriate priorities and change frequencies
- Created `app/robots.ts` allowing all crawlers except `/style-guide`
- Added JSON-LD structured data (Organization + WebSite schemas) to root layout
- Heading hierarchy verified: all pages have single H1 with proper H2/H3 nesting
- All images have alt text via props; decorative icons use `aria-hidden="true"`
- All 385 tests pass, lint clean, build successful

### File List
| File | Action |
|------|--------|
| app/page.tsx | Modified - Added metadata export with title, description, OG, Twitter |
| app/faq/layout.tsx | Modified - Added Twitter card metadata |
| app/pricing/page.tsx | Modified - Added Twitter card metadata |
| app/about/page.tsx | Modified - Added Twitter card metadata |
| app/contact/page.tsx | Modified - Added Twitter card metadata |
| app/privacy/page.tsx | Modified - Added Twitter card metadata |
| app/terms/page.tsx | Modified - Added Twitter card metadata |
| app/services/amazon/page.tsx | Modified - Added Twitter card metadata |
| app/services/etsy/page.tsx | Modified - Added Twitter card metadata |
| app/layout.tsx | Modified - Added JSON-LD Organization and WebSite schemas |
| app/sitemap.ts | Created - Next.js sitemap generation with 9 pages |
| app/robots.ts | Created - Next.js robots.txt generation |

---

## QA Results

### Review Date: 2025-12-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

**Overall: Excellent** - The SEO optimization implementation is comprehensive and well-executed. All 12 files were reviewed and show consistent quality, proper TypeScript typing, and adherence to Next.js best practices.

**Highlights:**
- Clean metadata exports using Next.js 14 Metadata API consistently across all pages
- Proper use of layout file for FAQ page to handle client component metadata pattern
- JSON-LD structured data correctly implemented with both Organization and WebSite schemas
- Sitemap and robots.txt use Next.js native generation functions
- All images have descriptive, contextual alt text (not keyword-stuffed)
- Twitter card metadata added alongside Open Graph for complete social sharing

**Code Observations:**
- All metadata follows the title template pattern (`%s | Agency Site`)
- Sitemap priorities appropriately weighted (1.0 homepage, 0.9 contact/pricing, 0.8 services, 0.3 legal)
- Change frequencies reasonable (weekly for pricing, yearly for legal pages)
- JSON-LD schemas are minimal but complete for organization type

### Refactoring Performed

None required - implementation is clean and follows project standards.

### Compliance Check

- Coding Standards: ✓ All files typed, JSDoc present, no console.log, proper imports
- Project Structure: ✓ Files placed in correct locations per unified-project-structure
- Testing Strategy: ✓ 385 tests passing, lint clean, build successful
- All ACs Met: ✓ All 8 acceptance criteria verified

### Improvements Checklist

All items already addressed by developer:

- [x] Unique title and meta description for all 9 pages
- [x] Open Graph + Twitter cards on all pages
- [x] Semantic heading hierarchy verified (H1 → H2 → H3)
- [x] Image alt text for all meaningful images in ResultsGallery
- [x] sitemap.xml generation with all public pages
- [x] robots.txt with appropriate allow/disallow rules
- [x] JSON-LD Organization and WebSite schemas
- [x] Lint, tests, and build all passing

**Optional Future Enhancements (not required for this story):**
- [ ] Add BreadcrumbList schema for services pages (nice-to-have)
- [ ] Consider adding FAQPage schema to FAQ page for rich snippets
- [ ] Add image to Open Graph metadata when logo is available

### Security Review

✓ No security concerns - SEO implementation is read-only metadata with no user input handling.

### Performance Considerations

✓ No performance concerns:
- JSON-LD scripts are inline and minimal (~300 bytes each)
- Sitemap/robots are generated at build time (static)
- No additional runtime overhead

### Files Modified During Review

None - no refactoring required.

### Gate Status

Gate: **PASS** → docs/qa/gates/4.4-seo-optimization.yml

### Recommended Status

✓ **Ready for Done** - All acceptance criteria met, tests passing, implementation follows best practices.
