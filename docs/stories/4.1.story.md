# Story 4.1: Privacy Policy Page

## Status

Done

## Story

**As a** visitor,
**I want** to read the privacy policy,
**so that** I understand how my data is collected and used.

## Acceptance Criteria

1. Privacy Policy page accessible from footer
2. Content covers: data collection, cookies, third-party services, user rights
3. Mentions specific integrations (analytics, form services, email marketing)
4. Formatted for readability (headings, sections)
5. Last updated date displayed
6. Placeholder content acceptable if legal review pending

## Tasks / Subtasks

- [x] Task 1: Create privacy policy content JSON file (AC: 2, 3, 4, 5)
  - [x] Create `content/legal/privacy.json`
  - [x] Define `PrivacyPolicyContent` type in `lib/types.ts`
  - [x] Structure content with sections array containing: title, content
  - [x] Include sections: Introduction, Data Collection, Cookies, Third-Party Services, User Rights, Contact, Changes to Policy
  - [x] Include `lastUpdated` date field
  - [x] Mention specific services: Plausible Analytics, Formspree, ConvertKit, Cal.com

- [x] Task 2: Create content accessor function (AC: 2, 3, 4, 5)
  - [x] Add `getPrivacyPolicyContent()` function in `lib/content.ts`
  - [x] Import privacy.json and cast to typed interface
  - [x] Add JSDoc documentation

- [x] Task 3: Create Privacy Policy page (AC: 1, 4, 5)
  - [x] Create `app/privacy/page.tsx`
  - [x] Add SEO metadata (title, description, openGraph)
  - [x] Create hero section with page title
  - [x] Render "Last Updated" date prominently
  - [x] Map through content sections rendering headings and paragraphs
  - [x] Use Container component for consistent layout
  - [x] Ensure proper heading hierarchy (h1 for title, h2 for sections)

- [x] Task 4: Verify footer link works (AC: 1)
  - [x] Confirm `/privacy` route renders correctly
  - [x] Verify footer link at `/privacy` navigates to page
  - [x] Link already exists in `components/layout/footer.tsx` line 253-257

- [x] Task 5: Write component tests (AC: all)
  - [x] Create `tests/app/privacy.test.tsx`
    - Test: renders page title
    - Test: renders last updated date
    - Test: renders all content sections
    - Test: has correct heading hierarchy
    - Test: mentions third-party services
  - [x] Create `tests/lib/content-privacy.test.ts`
    - Test: getPrivacyPolicyContent returns valid data
    - Test: lastUpdated is present
    - Test: sections array has expected structure

- [x] Task 6: Final verification (AC: all)
  - [x] Run `npm run lint` - ensure no errors
  - [x] Run `npm run build` - ensure successful build
  - [x] Run `npm run test:run` - ensure all tests pass
  - [x] Manually verify page is accessible from footer link
  - [x] Manually verify content is readable and properly formatted

## Dev Notes

### Previous Story Insights (Story 3.7)
[Source: docs/stories/3.7.story.md#dev-agent-record]

- 344 tests passing with Vitest + React Testing Library
- Content accessor pattern: `getXContent()` returns typed content from JSON
- API client pattern in `lib/api/`: standardized response format
- Components follow JSDoc documentation standard
- Lint and build passing

### Page File Location
[Source: docs/architecture/unified-project-structure.md]

```
app/
├── privacy/
│   └── page.tsx            # Privacy Policy (/privacy)
```

The privacy page route is already defined in the architecture. The footer link to `/privacy` already exists in `components/layout/footer.tsx`.

### Content File Pattern
[Source: docs/architecture/unified-project-structure.md, lib/content.ts]

Following existing content patterns:
- JSON content files in `content/` directory
- Type definitions in `lib/types.ts`
- Accessor functions in `lib/content.ts`

Create new structure:
```
content/
├── legal/
│   └── privacy.json        # NEW - Privacy policy content
```

### Privacy Policy Content Structure

Based on AC requirements and existing services, the privacy.json should include:

```typescript
// lib/types.ts - Add new types
/**
 * Represents a section in a legal document (privacy policy, terms).
 */
export interface LegalSection {
  /** Section identifier */
  id: string;
  /** Section heading */
  title: string;
  /** Section content (can be markdown-like with paragraphs) */
  content: string[];
}

/**
 * Privacy Policy page content structure.
 */
export interface PrivacyPolicyContent {
  /** Page title */
  title: string;
  /** Last updated date (ISO format) */
  lastUpdated: string;
  /** Introduction text */
  introduction: string;
  /** Content sections */
  sections: LegalSection[];
}
```

### Third-Party Services to Document
[Source: docs/architecture/external-apis.md, docs/architecture/tech-stack.md]

| Service | Purpose | Data Collected |
|---------|---------|----------------|
| Plausible Analytics | Privacy-friendly analytics | Page views, events (no cookies, no personal data) |
| Formspree | Contact form handling | Name, email, platform, message |
| ConvertKit | Email newsletter | Email address |
| Cal.com | Consultation booking | Name, email, scheduling info |

**Key Privacy Note**: Plausible is cookie-free and GDPR-compliant by default. No cookie consent required specifically for Plausible.

### Page Component Pattern
[Source: app/about/page.tsx, app/faq/page.tsx]

Follow existing page patterns:
- Server component (no "use client" needed for static content)
- Export `metadata` for SEO
- Use `Container` for layout
- JSDoc for page component

Example structure:
```typescript
import type { Metadata } from "next";
import { getPrivacyPolicyContent } from "@/lib/content";
import { Container } from "@/components/layout/container";

export const metadata: Metadata = {
  title: "Privacy Policy | Marketplace Consultants",
  description: "Learn how we collect, use, and protect your data.",
  // ... openGraph
};

export default function PrivacyPage(): React.ReactElement {
  const content = getPrivacyPolicyContent();

  return (
    <main>
      {/* Hero */}
      <section className="py-12 md:py-16 bg-muted/30">
        <Container>
          <h1>...</h1>
          <p>Last updated: {content.lastUpdated}</p>
        </Container>
      </section>

      {/* Content Sections */}
      <section className="py-16 md:py-20">
        <Container>
          <div className="prose max-w-3xl mx-auto">
            {content.sections.map((section) => (
              <div key={section.id}>
                <h2>{section.title}</h2>
                {section.content.map((para, i) => (
                  <p key={i}>{para}</p>
                ))}
              </div>
            ))}
          </div>
        </Container>
      </section>
    </main>
  );
}
```

### Styling Considerations
[Source: tailwind.config.ts, existing pages]

- Use Tailwind prose class for readable text content (may need `@tailwindcss/typography` plugin)
- Alternatively, apply manual text styling classes
- Maintain consistent spacing with other content pages
- Use `max-w-3xl` for optimal reading width (matches FAQ page pattern)

### Heading Hierarchy for Accessibility
[Source: docs/architecture/coding-standards.md - Accessibility]

- `h1`: Page title ("Privacy Policy")
- `h2`: Section headings (Data Collection, Cookies, etc.)
- Avoid skipping heading levels
- Semantic HTML structure important for SEO (AC mentions this in Story 4.4)

## Testing

[Source: docs/architecture/testing-strategy.md]

### Test Locations
- `tests/app/privacy.test.tsx` - Page component tests
- `tests/lib/content-privacy.test.ts` - Content accessor tests

### Testing Framework
- Vitest + React Testing Library
- Import from `@testing-library/react`
- Use `describe`, `it`, `expect` from `vitest`

### Privacy Page Test Examples

```typescript
// tests/app/privacy.test.tsx
import { render, screen } from "@testing-library/react";
import { describe, it, expect } from "vitest";
import PrivacyPage from "@/app/privacy/page";

describe("PrivacyPage", () => {
  it("renders page title", () => {
    render(<PrivacyPage />);
    expect(screen.getByRole("heading", { level: 1 })).toHaveTextContent(/privacy policy/i);
  });

  it("renders last updated date", () => {
    render(<PrivacyPage />);
    expect(screen.getByText(/last updated/i)).toBeInTheDocument();
  });

  it("renders content sections with h2 headings", () => {
    render(<PrivacyPage />);
    const h2s = screen.getAllByRole("heading", { level: 2 });
    expect(h2s.length).toBeGreaterThan(0);
  });

  it("mentions third-party services", () => {
    render(<PrivacyPage />);
    expect(screen.getByText(/plausible/i)).toBeInTheDocument();
    expect(screen.getByText(/formspree/i)).toBeInTheDocument();
  });
});
```

### Content Accessor Test Examples

```typescript
// tests/lib/content-privacy.test.ts
import { describe, it, expect } from "vitest";
import { getPrivacyPolicyContent } from "@/lib/content";

describe("getPrivacyPolicyContent", () => {
  it("returns valid privacy policy content", () => {
    const content = getPrivacyPolicyContent();
    expect(content).toBeDefined();
    expect(content.title).toBeTruthy();
    expect(content.lastUpdated).toBeTruthy();
  });

  it("has sections array with expected structure", () => {
    const content = getPrivacyPolicyContent();
    expect(Array.isArray(content.sections)).toBe(true);
    expect(content.sections.length).toBeGreaterThan(0);

    content.sections.forEach((section) => {
      expect(section.id).toBeTruthy();
      expect(section.title).toBeTruthy();
      expect(Array.isArray(section.content)).toBe(true);
    });
  });
});
```

### Test Coverage Goals
- Page renders correctly with all content
- Content accessor returns properly typed data
- Heading hierarchy is correct
- Third-party services are mentioned
- Last updated date is displayed

---

## Change Log

| Date | Version | Description | Author |
|------|---------|-------------|--------|
| 2025-12-06 | 1.0 | Initial story draft | SM Agent (Bob) |

---

## Dev Agent Record

### Agent Model Used
Claude Opus 4.5 (claude-opus-4-5-20251101)

### Debug Log References
No debug issues encountered.

### Completion Notes List
- Created privacy policy content JSON with 6 sections covering all AC requirements
- Added `LegalSection` and `PrivacyPolicyContent` types to `lib/types.ts`
- Added `getPrivacyPolicyContent()` accessor function with JSDoc documentation
- Created Privacy Policy page as server component with proper SEO metadata
- Footer link to `/privacy` already existed (line 253-257)
- All 355 tests pass (11 new tests for privacy policy)
- Lint passes with no errors
- Build passes with `/privacy` route generated

### File List
| File | Status |
|------|--------|
| content/legal/privacy.json | Created |
| lib/types.ts | Modified (added LegalSection, PrivacyPolicyContent) |
| lib/content.ts | Modified (added getPrivacyPolicyContent) |
| app/privacy/page.tsx | Created |
| tests/app/privacy.test.tsx | Created |
| tests/lib/content-privacy.test.ts | Created |

---

## QA Results

### Review Date: 2025-12-06

### Reviewed By: Quinn (Test Architect)

### Code Quality Assessment

The implementation is clean, well-structured, and follows established project patterns. The Privacy Policy page is implemented as a server component with proper SEO metadata, type-safe content accessors, and semantic HTML structure. The code demonstrates excellent adherence to project coding standards.

**Strengths:**
- Content JSON structure is clean with proper section IDs and type definitions
- Page component follows the same pattern as other content pages (FAQ, About)
- JSDoc documentation present on types, accessor function, and page component
- Content accessed through type-safe accessor function, not direct JSON import
- Proper heading hierarchy (h1 → h2) for accessibility and SEO
- Comprehensive test coverage at both page and accessor levels

### Refactoring Performed

None required - code quality is excellent.

### Compliance Check

- Coding Standards: ✓ All rules followed (typed, content via accessors, JSDoc documentation, no console logs)
- Project Structure: ✓ Files in correct locations per unified-project-structure.md
- Testing Strategy: ✓ Unit tests for page and accessor function following established patterns
- All ACs Met: ✓ All 6 acceptance criteria fully implemented and tested

### Improvements Checklist

All items met - no changes required:

- [x] Content JSON properly structured with all required sections
- [x] Type definitions follow project interface patterns
- [x] Accessor function with JSDoc documentation
- [x] Page component with SEO metadata and proper structure
- [x] Footer link to /privacy exists and works
- [x] All 11 tests pass (6 page tests + 5 accessor tests)
- [x] Lint passes with no errors
- [x] Build succeeds with /privacy route generated

### Security Review

No security concerns. The page is static content with no user input, data processing, or external API calls at runtime. Content is statically generated at build time.

### Performance Considerations

Excellent performance profile:
- Static page generation (no runtime rendering)
- Smallest JS bundle in the app (145 B first load)
- No client-side JavaScript required
- Total First Load JS: 87.5 kB (shared + page)

### Files Modified During Review

None - no refactoring was necessary.

### Gate Status

Gate: **PASS** → docs/qa/gates/4.1-privacy-policy-page.yml

### Recommended Status

✓ **Ready for Done**

All acceptance criteria met, tests pass (355 total, 11 for this story), lint clean, build successful, code quality excellent.
